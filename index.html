<!DOCTYPE html>
<html lang="uk" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Hub ‚Äî –£–∫—Ä–î–£–ó–¢</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f; --bg2: #111118; --bg3: #1a1a24;
    --border: #2a2a3a; --accent: #f0c040; --accent2: #e05050;
    --text: #e8e8f0; --text2: #8888aa; --card: #13131e;
    --success: #40d080; --warning: #f0a030; --radius: 12px;
  }
  [data-theme="light"] {
    --bg: #f4f4f8; --bg2: #ffffff; --bg3: #ebebf3;
    --border: #d0d0e0; --text: #1a1a2e; --text2: #606088; --card: #ffffff;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Syne', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; transition: background 0.3s, color 0.3s; }

  #login-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--bg); position: relative; overflow: hidden; }
  #login-screen::before { content: ''; position: absolute; width: 600px; height: 600px; background: radial-gradient(circle, rgba(240,192,64,0.08) 0%, transparent 70%); top: -200px; right: -200px; pointer-events: none; }
  #login-screen::after { content: ''; position: absolute; width: 400px; height: 400px; background: radial-gradient(circle, rgba(224,80,80,0.06) 0%, transparent 70%); bottom: -100px; left: -100px; pointer-events: none; }
  .login-box { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 44px; width: 440px; max-width: 95vw; position: relative; z-index: 1; animation: fadeUp 0.6s ease; }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
  .login-logo { display: flex; align-items: center; gap: 12px; margin-bottom: 28px; }
  .login-logo .icon { width: 42px; height: 42px; background: var(--accent); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
  .login-logo h1 { font-size: 20px; font-weight: 800; }
  .login-logo span { color: var(--accent); }
  .login-box h2 { font-size: 24px; font-weight: 800; margin-bottom: 4px; }
  .login-box > p { color: var(--text2); font-size: 13px; margin-bottom: 22px; }
  .step-sep { display: flex; align-items: center; gap: 10px; margin: 18px 0; font-size: 11px; font-weight: 700; color: var(--text2); letter-spacing: 0.5px; text-transform: uppercase; }
  .step-sep::before, .step-sep::after { content: ''; flex: 1; height: 1px; background: var(--border); }
  .field { margin-bottom: 12px; }
  .field label { display: block; font-size: 11px; font-weight: 700; color: var(--text2); margin-bottom: 5px; letter-spacing: 0.5px; text-transform: uppercase; }
  .field input { width: 100%; background: var(--bg3); border: 1px solid var(--border); border-radius: var(--radius); padding: 11px 14px; color: var(--text); font-family: 'JetBrains Mono', monospace; font-size: 14px; outline: none; transition: border-color 0.2s; }
  .field input:focus { border-color: var(--accent); }
  .btn-primary { width: 100%; background: var(--accent); color: #0a0a0f; border: none; border-radius: var(--radius); padding: 13px; font-family: 'Syne', sans-serif; font-size: 15px; font-weight: 700; cursor: pointer; transition: opacity 0.2s, transform 0.1s; margin-top: 6px; }
  .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
  .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
  .login-error { background: rgba(224,80,80,0.1); border: 1px solid rgba(224,80,80,0.3); border-radius: var(--radius); padding: 10px 14px; font-size: 12px; color: var(--accent2); margin-top: 10px; display: none; }
  .login-info { font-size: 11px; color: var(--text2); text-align: center; margin-top: 12px; line-height: 1.5; }

  #app { display: none; min-height: 100vh; }
  .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: 236px; background: var(--bg2); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 100; }
  .sidebar-logo { padding: 20px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--border); }
  .sidebar-logo .icon { width: 32px; height: 32px; background: var(--accent); border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
  .sidebar-logo h1 { font-size: 14px; font-weight: 800; }
  .sidebar-logo span { color: var(--accent); }
  .group-badge { padding: 5px 20px; background: rgba(240,192,64,0.06); border-bottom: 1px solid var(--border); font-size: 11px; color: var(--accent); font-family: 'JetBrains Mono', monospace; font-weight: 600; }
  .nav { padding: 12px 10px; flex: 1; }
  .nav-item { display: flex; align-items: center; gap: 10px; padding: 9px 12px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; color: var(--text2); transition: all 0.15s; margin-bottom: 2px; user-select: none; }
  .nav-item:hover { background: var(--bg3); color: var(--text); }
  .nav-item.active { background: rgba(240,192,64,0.12); color: var(--accent); }
  .nav-icon { font-size: 15px; width: 18px; text-align: center; }
  .sidebar-bottom { padding: 12px 10px; border-top: 1px solid var(--border); }
  .user-card { display: flex; align-items: center; gap: 8px; padding: 9px 12px; border-radius: 8px; background: var(--bg3); }
  .user-avatar { width: 28px; height: 28px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: #0a0a0f; flex-shrink: 0; }
  .user-info { flex: 1; min-width: 0; }
  .user-name { font-size: 12px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .user-role { font-size: 10px; color: var(--text2); }
  .icon-btn { background: none; border: none; color: var(--text2); cursor: pointer; font-size: 14px; padding: 3px; border-radius: 5px; transition: color 0.2s; }
  .icon-btn:hover { color: var(--text); }
  .fb-status { font-size: 10px; color: var(--text2); display: flex; align-items: center; gap: 5px; margin-top: 6px; padding: 0 4px; }
  .fb-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--warning); flex-shrink: 0; }
  .fb-dot.on { background: var(--success); }

  .main { margin-left: 236px; min-height: 100vh; padding: 30px; }
  .page { display: none; animation: fadeIn 0.3s ease; }
  .page.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
  .page-header { margin-bottom: 22px; }
  .page-header h2 { font-size: 24px; font-weight: 800; margin-bottom: 3px; }
  .page-header p { color: var(--text2); font-size: 12px; }

  .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; margin-bottom: 24px; }
  .stat-card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; display: flex; align-items: center; gap: 12px; }
  .stat-icon { width: 40px; height: 40px; border-radius: 9px; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
  .stat-icon.yellow { background: rgba(240,192,64,0.15); }
  .stat-icon.red { background: rgba(224,80,80,0.15); }
  .stat-icon.green { background: rgba(64,208,128,0.15); }
  .stat-icon.blue { background: rgba(64,128,240,0.15); }
  .stat-val { font-size: 24px; font-weight: 800; font-family: 'JetBrains Mono', monospace; }
  .stat-label { font-size: 11px; color: var(--text2); }

  .deadline-list { display: flex; flex-direction: column; gap: 7px; }
  .deadline-item { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 12px 16px; display: flex; align-items: center; gap: 12px; transition: border-color 0.2s, background 0.2s; }
  .deadline-item.clickable:hover { border-color: var(--accent); background: var(--bg3); cursor: pointer; }
  .deadline-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
  .deadline-dot.urgent { background: var(--accent2); box-shadow: 0 0 6px rgba(224,80,80,0.5); }
  .deadline-dot.soon { background: var(--warning); }
  .deadline-dot.ok { background: var(--success); }
  .deadline-info { flex: 1; min-width: 0; }
  .deadline-name { font-size: 13px; font-weight: 600; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .deadline-course { font-size: 11px; color: var(--text2); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .deadline-right { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
  .deadline-date { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--text2); }
  .deadline-date.urgent { color: var(--accent2); }
  .deadline-date.soon { color: var(--warning); }

  .toolbar { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
  .toolbar input[type="text"] { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 8px 12px; color: var(--text); font-family: 'Syne', sans-serif; font-size: 12px; outline: none; width: 200px; transition: border-color 0.2s; }
  .toolbar input[type="text"]:focus { border-color: var(--accent); }
  .toolbar select { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 7px 10px; color: var(--text); font-family: 'Syne', sans-serif; font-size: 12px; outline: none; }
  .toolbar-right { margin-left: auto; display: flex; gap: 6px; align-items: center; }
  .section-title { font-size: 10px; font-weight: 700; color: var(--text2); letter-spacing: 1px; text-transform: uppercase; margin: 20px 0 9px; }

  .upload-zone { border: 2px dashed var(--border); border-radius: var(--radius); padding: 26px; text-align: center; cursor: pointer; transition: border-color 0.2s, background 0.2s; margin-bottom: 16px; }
  .upload-zone:hover, .upload-zone.drag { border-color: var(--accent); background: rgba(240,192,64,0.04); }
  .upload-zone .up-icon { font-size: 26px; margin-bottom: 7px; }
  .upload-zone p { font-size: 12px; color: var(--text2); }
  .upload-zone strong { color: var(--accent); }
  #file-input { display: none; }

  .file-list { display: flex; flex-direction: column; gap: 7px; }
  .file-item { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 11px 14px; display: flex; align-items: center; gap: 11px; }
  .file-ext { width: 34px; height: 34px; border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 9px; font-weight: 700; font-family: 'JetBrains Mono', monospace; flex-shrink: 0; }
  .ext-pdf { background: rgba(224,80,80,0.15); color: var(--accent2); }
  .ext-docx { background: rgba(64,128,240,0.15); color: #4080f0; }
  .ext-pptx { background: rgba(240,128,64,0.15); color: #f08040; }
  .ext-other { background: var(--bg3); color: var(--text2); }
  .file-info { flex: 1; min-width: 0; }
  .file-name { font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .file-meta { font-size: 10px; color: var(--text2); margin-top: 2px; }
  .file-actions { display: flex; gap: 5px; flex-shrink: 0; }

  .btn-sm { background: var(--bg3); border: 1px solid var(--border); border-radius: 6px; padding: 5px 10px; font-size: 11px; font-weight: 600; color: var(--text2); cursor: pointer; transition: all 0.15s; font-family: 'Syne', sans-serif; }
  .btn-sm:hover { border-color: var(--accent); color: var(--accent); }
  .btn-sm.accent { background: var(--accent); border-color: var(--accent); color: #0a0a0f; }
  .btn-sm.accent:hover { opacity: 0.85; color: #0a0a0f; }
  .btn-sm.danger:hover { border-color: var(--accent2); color: var(--accent2); }

  .course-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 11px; }
  .course-list.list-view { grid-template-columns: 1fr; }
  .course-card { background: var(--card); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; cursor: pointer; transition: border-color 0.2s, transform 0.15s; text-decoration: none; color: var(--text); display: block; }
  .course-card:hover { border-color: var(--accent); transform: translateY(-2px); }
  .list-view .course-card { display: flex; align-items: center; gap: 12px; padding: 11px 14px; }
  .list-view .course-card:hover { transform: none; }
  .course-num { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--accent); font-weight: 500; margin-bottom: 5px; flex-shrink: 0; }
  .list-view .course-num { margin-bottom: 0; }
  .course-name { font-size: 13px; font-weight: 700; line-height: 1.3; flex: 1; margin-bottom: 3px; }
  .list-view .course-name { margin-bottom: 0; }
  .course-meta { font-size: 11px; color: var(--text2); }
  .filter-tab { padding: 5px 11px; border-radius: 20px; font-size: 11px; font-weight: 600; border: 1px solid var(--border); background: var(--card); color: var(--text2); cursor: pointer; transition: all 0.15s; font-family: 'Syne', sans-serif; }
  .filter-tab:hover { border-color: var(--accent); color: var(--accent); }
  .filter-tab.active { background: var(--accent); border-color: var(--accent); color: #0a0a0f; }
  .view-btn { width: 28px; height: 28px; border-radius: 6px; border: 1px solid var(--border); background: var(--card); color: var(--text2); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; transition: all 0.15s; }
  .view-btn.active { background: var(--accent); border-color: var(--accent); color: #0a0a0f; }

  .tag { display: inline-block; padding: 2px 7px; border-radius: 20px; font-size: 10px; font-weight: 600; background: var(--bg3); color: var(--text2); border: 1px solid var(--border); }
  .tag.green { background: rgba(64,208,128,0.12); color: var(--success); border-color: rgba(64,208,128,0.2); }
  .sync-badge { display: inline-flex; align-items: center; gap: 6px; background: rgba(64,208,128,0.1); border: 1px solid rgba(64,208,128,0.2); border-radius: 20px; padding: 3px 10px; font-size: 11px; color: var(--success); font-weight: 600; }
  .sync-dot { width: 5px; height: 5px; background: var(--success); border-radius: 50%; animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

  .loading { display: flex; align-items: center; gap: 9px; color: var(--text2); font-size: 12px; padding: 18px 0; }
  .spinner { width: 15px; height: 15px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.7s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .empty-state { text-align: center; padding: 36px 20px; color: var(--text2); }
  .empty-state .emoji { font-size: 32px; margin-bottom: 9px; }
  .empty-state p { font-size: 12px; }

  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 999; }
  .modal-overlay.show { display: flex; }
  .modal { background: var(--bg2); border: 1px solid var(--border); border-radius: 16px; padding: 26px; width: 440px; max-width: 95vw; animation: fadeUp 0.3s ease; }
  .modal h3 { font-size: 17px; font-weight: 800; margin-bottom: 16px; }
  .modal .field input { font-family: 'Syne', sans-serif; }
  .modal-actions { display: flex; gap: 7px; justify-content: flex-end; margin-top: 16px; }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">
      <div class="icon">üéì</div>
      <h1>Student<span>Hub</span></h1>
    </div>
    <h2>–í—Ö—ñ–¥</h2>
    <p>–ü–æ—Ä—Ç–∞–ª —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –£–∫—Ä–î–£–ó–¢</p>
    <div class="field">
      <label>–õ–æ–≥—ñ–Ω –≤—ñ–¥ Moodle</label>
      <input type="text" id="login-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="username">
    </div>
    <div class="field">
      <label>–ü–∞—Ä–æ–ª—å –≤—ñ–¥ Moodle</label>
      <input type="password" id="pass-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
    </div>
    <div class="step-sep">–í–∞—à–∞ –≥—Ä—É–ø–∞</div>
    <div class="field">
      <label>–ö–æ–¥ –≥—Ä—É–ø–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ –ö–ù-23-1)</label>
      <input type="text" id="group-input" placeholder="–ö–ù-23-1" autocomplete="off" style="font-family:'Syne',sans-serif;text-transform:uppercase;">
    </div>
    <button class="btn-primary" id="login-btn" onclick="doLogin()">–£–≤—ñ–π—Ç–∏</button>
    <div class="login-error" id="login-error"></div>
    <p class="login-info">–õ–æ–≥—ñ–Ω/–ø–∞—Ä–æ–ª—å –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä –£–∫—Ä–î–£–ó–¢ —ñ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è.<br>–§–∞–π–ª–∏ –≥—Ä—É–ø–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É Firebase.</p>
  </div>
</div>

<!-- APP -->
<div id="app">
  <nav class="sidebar">
    <div class="sidebar-logo">
      <div class="icon">üéì</div>
      <h1>Student<span>Hub</span></h1>
    </div>
    <div class="group-badge" id="group-badge">–ì—Ä—É–ø–∞: ‚Äî</div>
    <div class="nav">
      <div class="nav-item active" onclick="showPage('dashboard')"><span class="nav-icon">üè†</span>–ì–æ–ª–æ–≤–Ω–∞</div>
      <div class="nav-item" onclick="showPage('deadlines')"><span class="nav-icon">‚è∞</span>–î–µ–¥–ª–∞–π–Ω–∏</div>
      <div class="nav-item" onclick="showPage('courses')"><span class="nav-icon">üìö</span>–ö—É—Ä—Å–∏</div>
      <div class="nav-item" onclick="showPage('files')"><span class="nav-icon">üìÅ</span>–§–∞–π–ª–∏ –≥—Ä—É–ø–∏</div>
      <div class="nav-item" onclick="showPage('materials')"><span class="nav-icon">üìù</span>–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏</div>
    </div>
    <div class="sidebar-bottom">
      <div class="user-card">
        <div class="user-avatar" id="user-avatar">?</div>
        <div class="user-info">
          <div class="user-name" id="user-name">...</div>
          <div class="user-role" id="user-group-label">–°—Ç—É–¥–µ–Ω—Ç</div>
        </div>
        <button class="icon-btn" onclick="toggleTheme()" title="–¢–µ–º–∞">üåì</button>
        <button class="icon-btn" onclick="doLogout()" title="–í–∏–π—Ç–∏">‚Ü©</button>
      </div>
      <div class="fb-status"><div class="fb-dot" id="fb-dot"></div><span id="fb-label">–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase...</span></div>
    </div>
  </nav>

  <main class="main">
    <!-- DASHBOARD -->
    <div class="page active" id="page-dashboard">
      <div class="page-header">
        <h2>–î–æ–±—Ä–∏–π –¥–µ–Ω—å! üëã</h2>
        <p id="dash-subtitle">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
      </div>
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:18px;flex-wrap:wrap;">
        <div class="sync-badge"><div class="sync-dot"></div>–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∑ Moodle</div>
        <button class="btn-sm" onclick="syncMoodle()">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
      </div>
      <div class="cards-grid">
        <div class="stat-card"><div class="stat-icon yellow">üìö</div><div><div class="stat-val" id="stat-courses">‚Äî</div><div class="stat-label">–ê–∫—Ç–∏–≤–Ω–∏—Ö –∫—É—Ä—Å—ñ–≤</div></div></div>
        <div class="stat-card"><div class="stat-icon red">‚è∞</div><div><div class="stat-val" id="stat-urgent">‚Äî</div><div class="stat-label">–¢–µ—Ä–º—ñ–Ω–æ–≤–æ –∑–¥–∞—Ç–∏</div></div></div>
        <div class="stat-card"><div class="stat-icon green">‚úÖ</div><div><div class="stat-val" id="stat-done">‚Äî</div><div class="stat-label">–î–µ–¥–ª–∞–π–Ω—ñ–≤ –º–∏–Ω—É–ª–æ</div></div></div>
        <div class="stat-card"><div class="stat-icon blue">üìÅ</div><div><div class="stat-val" id="stat-files">‚Äî</div><div class="stat-label">–§–∞–π–ª—ñ–≤ —É –≥—Ä—É–ø—ñ</div></div></div>
      </div>
      <div class="section-title">–ù–∞–π–±–ª–∏–∂—á—ñ –¥–µ–¥–ª–∞–π–Ω–∏</div>
      <div id="dash-deadlines"><div class="loading"><div class="spinner"></div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div></div>
    </div>

    <!-- DEADLINES -->
    <div class="page" id="page-deadlines">
      <div class="page-header"><h2>‚è∞ –î–µ–¥–ª–∞–π–Ω–∏</h2><p>–ó–∞–≤–¥–∞–Ω–Ω—è –∑ Moodle ‚Äî –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</p></div>
      <div class="toolbar">
        <input type="text" id="dl-search" placeholder="üîç –ü–æ—à—É–∫ –∑–∞–≤–¥–∞–Ω–Ω—è..." oninput="applyDeadlineFilter()">
        <select id="dl-filter" onchange="applyDeadlineFilter()">
          <option value="all">–í—Å—ñ</option>
          <option value="active">–¢—ñ–ª—å–∫–∏ –∞–∫—Ç–∏–≤–Ω—ñ</option>
          <option value="urgent">–¢–µ—Ä–º—ñ–Ω–æ–≤—ñ (48 –≥–æ–¥)</option>
          <option value="past">–ú–∏–Ω—É–ª—ñ</option>
        </select>
        <div class="toolbar-right">
          <button class="btn-sm accent" onclick="syncMoodle()">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏</button>
        </div>
      </div>
      <div id="deadlines-list"><div class="loading"><div class="spinner"></div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ Moodle...</div></div>
    </div>

    <!-- COURSES -->
    <div class="page" id="page-courses">
      <div class="page-header"><h2>üìö –ú–æ—ó –∫—É—Ä—Å–∏</h2><p>–°–ø–∏—Å–æ–∫ –∫—É—Ä—Å—ñ–≤ –∑ Moodle ‚Äî –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏</p></div>
      <div class="toolbar">
        <input type="text" id="course-search" placeholder="üîç –ü–æ—à—É–∫ –∫—É—Ä—Å—É..." oninput="filterCourses()">
        <button class="filter-tab active" id="sort-name" onclick="setCourseSort('name')">–ó–∞ –Ω–∞–∑–≤–æ—é</button>
        <button class="filter-tab" id="sort-num" onclick="setCourseSort('num')">–ó–∞ –Ω–æ–º–µ—Ä–æ–º</button>
        <div class="toolbar-right">
          <div style="display:flex;gap:4px;">
            <button class="view-btn active" id="view-grid" onclick="setCourseView('grid')" title="–ö–∞—Ä—Ç–∫–∏">‚äû</button>
            <button class="view-btn" id="view-list" onclick="setCourseView('list')" title="–°–ø–∏—Å–æ–∫">‚ò∞</button>
          </div>
        </div>
      </div>
      <div id="courses-list"><div class="loading"><div class="spinner"></div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div></div>
    </div>

    <!-- FILES -->
    <div class="page" id="page-files">
      <div class="page-header">
        <h2>üìÅ –§–∞–π–ª–∏ –≥—Ä—É–ø–∏</h2>
        <p id="files-group-label">–°–ø—ñ–ª—å–Ω—ñ —Ñ–∞–π–ª–∏ –≤–∞—à–æ—ó –≥—Ä—É–ø–∏</p>
      </div>
      <div class="upload-zone" id="upload-zone" onclick="document.getElementById('file-input').click()" ondragover="event.preventDefault();this.classList.add('drag')" ondragleave="this.classList.remove('drag')" ondrop="handleDrop(event)">
        <div class="up-icon">üì§</div>
        <p><strong>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∞–±–æ –ø–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–∞–π–ª</strong></p>
        <p style="margin-top:3px;font-size:11px;">PDF, DOCX, PPTX, XLSX —Ç–∞ —ñ–Ω—à—ñ (–¥–æ 5–ú–ë)</p>
      </div>
      <input type="file" id="file-input" multiple onchange="handleFileSelect(this)">
      <div class="section-title">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ñ–∞–π–ª–∏</div>
      <div id="group-files-list"><div class="loading"><div class="spinner"></div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤...</div></div>
    </div>

    <!-- MATERIALS -->
    <div class="page" id="page-materials">
      <div class="page-header">
        <h2>üìù –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏</h2>
        <p id="materials-group-label">–ö–æ–Ω—Å–ø–µ–∫—Ç–∏ —Ç–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤–∞—à–æ—ó –≥—Ä—É–ø–∏</p>
      </div>
      <div class="toolbar">
        <input type="text" placeholder="üîç –ü–æ—à—É–∫ –º–∞—Ç–µ—Ä—ñ–∞–ª—É..." oninput="filterMaterials(this.value)">
        <div class="toolbar-right">
          <button class="btn-sm accent" onclick="showAddMaterial()">+ –î–æ–¥–∞—Ç–∏</button>
        </div>
      </div>
      <div id="materials-list"><div class="loading"><div class="spinner"></div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤...</div></div>
    </div>
  </main>
</div>

<!-- Modal -->
<div class="modal-overlay" id="add-material-modal">
  <div class="modal">
    <h3>üìù –î–æ–¥–∞—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª</h3>
    <div class="field"><label>–ù–∞–∑–≤–∞</label><input type="text" id="mat-name" placeholder="–ö–æ–Ω—Å–ø–µ–∫—Ç –ø–æ –≤–∏—â—ñ–π –º–∞—Ç–µ–º–∞—Ç–∏—Ü—ñ"></div>
    <div class="field"><label>–ü—Ä–µ–¥–º–µ—Ç</label><input type="text" id="mat-subject" placeholder="–í–∏—â–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞"></div>
    <div class="field"><label>–ü–æ—Å–∏–ª–∞–Ω–Ω—è –∞–±–æ –æ–ø–∏—Å</label><input type="text" id="mat-desc" placeholder="https://drive.google.com/..."></div>
    <div class="modal-actions">
      <button class="btn-sm" onclick="closeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button class="btn-sm accent" onclick="addMaterial()">–î–æ–¥–∞—Ç–∏</button>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
import { getFirestore, collection, addDoc, deleteDoc, doc, query, where, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

const cfg = {
  apiKey: "AIzaSyAXscEMkW51sejM_yBkMcL_QyvgfAWT7sE",
  authDomain: "student-hub-ukrdust.firebaseapp.com",
  projectId: "student-hub-ukrdust",
  storageBucket: "student-hub-ukrdust.firebasestorage.app",
  messagingSenderId: "181184327168",
  appId: "1:181184327168:web:3ceca4b24980f900eff2e5"
};
const fbApp = initializeApp(cfg);
const db = getFirestore(fbApp);
window._db = db;
window._fb = { collection, addDoc, deleteDoc, doc, query, where, orderBy, onSnapshot };
document.getElementById('fb-dot').classList.add('on');
document.getElementById('fb-label').textContent = 'Firebase –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ ‚úì';
</script>

<script>
const MOODLE = 'https://do.kart.edu.ua';
let token = '', userData = {}, allDeadlines = [], courses = [], currentGroup = '';
let unsubFiles = null, unsubMats = null, cachedFiles = [], cachedMats = [];

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
async function doLogin() {
  const username = document.getElementById('login-input').value.trim();
  const password = document.getElementById('pass-input').value;
  const group = document.getElementById('group-input').value.trim().toUpperCase().replace(/\s+/g,'-');
  const btn = document.getElementById('login-btn');
  const err = document.getElementById('login-error');
  err.style.display = 'none';
  if (!username || !password) { showErr('–í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω —Ç–∞ –ø–∞—Ä–æ–ª—å'); return; }
  if (!group) { showErr('–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –≤–∞—à–æ—ó –≥—Ä—É–ø–∏'); return; }
  btn.disabled = true; btn.textContent = '–í—Ö–æ–¥–∏–º–æ...';
  try {
    const r = await fetch(MOODLE + '/login/token.php?username=' + encodeURIComponent(username) + '&password=' + encodeURIComponent(password) + '&service=moodle_mobile_app');
    const d = await r.json();
    if (d.token) {
      token = d.token; currentGroup = group;
      localStorage.setItem('sh_token', token);
      localStorage.setItem('sh_group', group);
      await initApp();
    } else { showErr(d.error || '–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å'); }
  } catch(e) { showErr('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç.'); }
  btn.disabled = false; btn.textContent = '–£–≤—ñ–π—Ç–∏';
}
function showErr(msg) { const e = document.getElementById('login-error'); e.textContent = msg; e.style.display = 'block'; }
document.getElementById('pass-input').addEventListener('keydown', e => { if(e.key==='Enter') doLogin(); });
document.getElementById('group-input').addEventListener('input', function() { this.value = this.value.toUpperCase(); });

async function initApp() {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  document.getElementById('group-badge').textContent = 'üìå ' + currentGroup;
  document.getElementById('files-group-label').textContent = '–°–ø—ñ–ª—å–Ω—ñ —Ñ–∞–π–ª–∏ –≥—Ä—É–ø–∏ ' + currentGroup;
  document.getElementById('materials-group-label').textContent = '–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –≥—Ä—É–ø–∏ ' + currentGroup;
  await loadUserInfo();
  await syncMoodle();
  listenFiles();
  listenMats();
}

async function loadUserInfo() {
  try {
    const d = await moodleCall('core_webservice_get_site_info');
    userData = d;
    const name = d.fullname || '–°—Ç—É–¥–µ–Ω—Ç';
    document.getElementById('user-name').textContent = name;
    document.getElementById('user-avatar').textContent = name[0].toUpperCase();
    document.getElementById('user-group-label').textContent = currentGroup;
    const today = new Date().toLocaleDateString('uk-UA', {weekday:'long', day:'numeric', month:'long'});
    document.getElementById('dash-subtitle').textContent = today + ' ‚Ä¢ ' + name;
  } catch(e) {}
}

async function syncMoodle() { await Promise.all([loadCourses(), loadDeadlines()]); }

async function moodleCall(fn, params={}) {
  const p = new URLSearchParams({ wstoken: token, wsfunction: fn, moodlewsrestformat: 'json', ...params });
  const r = await fetch(MOODLE + '/webservice/rest/server.php?' + p);
  return r.json();
}

// ‚îÄ‚îÄ COURSES ‚îÄ‚îÄ
let courseView = 'grid', courseSort = 'name';
async function loadCourses() {
  try {
    const info = await moodleCall('core_webservice_get_site_info');
    const d = await moodleCall('core_enrol_get_users_courses', { userid: info.userid });
    courses = Array.isArray(d) ? d : [];
    document.getElementById('stat-courses').textContent = courses.length;
    filterCourses();
  } catch(e) { courses = []; }
}
function setCourseView(v) {
  courseView = v;
  document.getElementById('view-grid').classList.toggle('active', v==='grid');
  document.getElementById('view-list').classList.toggle('active', v==='list');
  filterCourses();
}
function setCourseSort(s) {
  courseSort = s;
  document.getElementById('sort-name').classList.toggle('active', s==='name');
  document.getElementById('sort-num').classList.toggle('active', s==='num');
  filterCourses();
}
function filterCourses() {
  const q = (document.getElementById('course-search')||{value:''}).value.toLowerCase();
  let list = courses.filter(c => !q || (c.fullname||c.shortname||'').toLowerCase().includes(q));
  if (courseSort==='name') list = list.slice().sort((a,b) => (a.fullname||a.shortname).localeCompare(b.fullname||b.shortname));
  const el = document.getElementById('courses-list');
  if (!list.length) { el.innerHTML = '<div class="empty-state"><div class="emoji">üìö</div><p>–ö—É—Ä—Å–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p></div>'; return; }
  const cls = courseView==='list' ? 'course-list list-view' : 'course-list';
  el.innerHTML = '<div class="' + cls + '">' + list.map((c,i) =>
    '<a class="course-card" href="https://do.kart.edu.ua/course/view.php?id=' + c.id + '" target="_blank">' +
    '<div class="course-num">–ö—É—Ä—Å #' + (i+1) + '</div>' +
    '<div class="course-name">' + (c.fullname||c.shortname) + '</div>' +
    '<div class="course-meta">' + (c.shortname||'') + '</div>' +
    '</a>'
  ).join('') + '</div>';
}

// ‚îÄ‚îÄ DEADLINES ‚îÄ‚îÄ
async function loadDeadlines() {
  try {
    const now = Math.floor(Date.now()/1000);
    const d = await moodleCall('core_calendar_get_action_events_by_timesort', {
      timesortfrom: now - 60*60*24*30,
      timesortto: now + 60*60*24*90,
      limitnum: 100
    });
    const events = d.events || [];
    allDeadlines = events
      .filter(e => e.timesort)
      .map(e => ({
        id: e.id,
        name: e.name,
        course: e.course ? e.course.fullname : '‚Äî',
        due: e.timesort,
        past: e.timesort < now,
        url: e.url || '#'
      }))
      .sort((a,b) => a.due - b.due);
    updateDeadlineStats();
    applyDeadlineFilter();
    renderDashDeadlines();
  } catch(e) {
    document.getElementById('deadlines-list').innerHTML = '<div class="empty-state"><div class="emoji">‚ö†Ô∏è</div><p>–ù–µ –≤–¥–∞–ª–æ—Å—å –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–µ–¥–ª–∞–π–Ω–∏</p></div>';
  }
}

function getDotClass(d) {
  if (d.past) return 'urgent';
  const diff = d.due - Date.now()/1000;
  if (diff < 60*60*48) return 'urgent';
  if (diff < 60*60*24*7) return 'soon';
  return 'ok';
}
function fmtDate(ts) {
  return new Date(ts*1000).toLocaleDateString('uk-UA', {day:'numeric', month:'short', hour:'2-digit', minute:'2-digit'});
}
function updateDeadlineStats() {
  const now = Date.now()/1000;
  const urgent = allDeadlines.filter(d => !d.past && (d.due - now) < 60*60*48).length;
  const past = allDeadlines.filter(d => d.past).length;
  document.getElementById('stat-urgent').textContent = urgent;
  document.getElementById('stat-done').textContent = past;
}
function applyDeadlineFilter() {
  const q = (document.getElementById('dl-search')||{value:''}).value.toLowerCase();
  const f = (document.getElementById('dl-filter')||{value:'all'}).value;
  const now = Date.now()/1000;
  let list = allDeadlines.filter(d => !q || d.name.toLowerCase().includes(q) || d.course.toLowerCase().includes(q));
  if (f === 'active') list = list.filter(d => !d.past);
  else if (f === 'urgent') list = list.filter(d => !d.past && (d.due - now) < 60*60*48);
  else if (f === 'past') list = list.filter(d => d.past);
  renderDeadlines(list, document.getElementById('deadlines-list'));
}
function renderDeadlines(list, el) {
  if (!list.length) { el.innerHTML = '<div class="empty-state"><div class="emoji">üéâ</div><p>–ù–µ–º–∞—î –¥–µ–¥–ª–∞–π–Ω—ñ–≤ –∑–∞ —Ü–∏–º —Ñ—ñ–ª—å—Ç—Ä–æ–º!</p></div>'; return; }
  el.innerHTML = '<div class="deadline-list">' + list.map(d => {
    const cls = getDotClass(d);
    const hasUrl = d.url && d.url !== '#';
    return '<div class="deadline-item' + (hasUrl ? ' clickable' : '') + '"' +
      (hasUrl ? ' onclick="window.open(\'' + d.url.replace(/'/g,"\\'") + '\',\'_blank\')"' : '') + '>' +
      '<div class="deadline-dot ' + cls + '"></div>' +
      '<div class="deadline-info">' +
        '<div class="deadline-name">' + d.name + (hasUrl ? ' <span style="opacity:0.4;font-size:10px">‚Üó</span>' : '') + '</div>' +
        '<div class="deadline-course">' + d.course + '</div>' +
      '</div>' +
      '<div class="deadline-right">' +
        '<div class="deadline-date ' + cls + '">' + fmtDate(d.due) + '</div>' +
        (d.past ? '<span class="tag">–ú–∏–Ω—É–≤</span>' : '') +
      '</div>' +
      '</div>';
  }).join('') + '</div>';
}
function renderDashDeadlines() {
  const el = document.getElementById('dash-deadlines');
  const top = allDeadlines.filter(d => !d.past).slice(0,5);
  if (!top.length) { el.innerHTML = '<div class="empty-state"><div class="emoji">üéâ</div><p>–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö –¥–µ–¥–ª–∞–π–Ω—ñ–≤!</p></div>'; return; }
  renderDeadlines(top, el);
}

// ‚îÄ‚îÄ FILES (Firebase Firestore) ‚îÄ‚îÄ
function listenFiles() {
  if (!window._db || !currentGroup) return;
  const { collection, query, where, orderBy, onSnapshot } = window._fb;
  if (unsubFiles) unsubFiles();
  const q = query(collection(window._db, 'files'), where('group', '==', currentGroup), orderBy('createdAt', 'desc'));
  unsubFiles = onSnapshot(q, snap => {
    cachedFiles = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderFiles(cachedFiles);
    document.getElementById('stat-files').textContent = cachedFiles.length;
  }, () => {
    document.getElementById('group-files-list').innerHTML = '<div class="empty-state"><div class="emoji">‚ö†Ô∏è</div><p>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –ú–æ–∂–ª–∏–≤–æ, Firebase —â–µ –Ω–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è.</p></div>';
  });
}
function handleFileSelect(inp) { Array.from(inp.files).forEach(uploadFile); inp.value=''; }
function handleDrop(e) {
  e.preventDefault();
  document.getElementById('upload-zone').classList.remove('drag');
  Array.from(e.dataTransfer.files).forEach(uploadFile);
}
async function uploadFile(file) {
  if (file.size > 5*1024*1024) { alert('–§–∞–π–ª –±—ñ–ª—å—à–µ 5–ú–ë ‚Äî —Å–ø—Ä–æ–±—É–π—Ç–µ –º–µ–Ω—à–∏–π.'); return; }
  if (!window._db) { alert('Firebase –Ω–µ –≥–æ—Ç–æ–≤–∏–π ‚Äî –∑–∞—á–µ–∫–∞–π—Ç–µ —Å–µ–∫—É–Ω–¥—É.'); return; }
  const { collection, addDoc } = window._fb;
  const zone = document.getElementById('upload-zone');
  zone.innerHTML = '<div class="up-icon">‚è≥</div><p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ' + file.name + '...</p>';
  const reader = new FileReader();
  reader.onload = async e => {
    try {
      await addDoc(collection(window._db, 'files'), {
        group: currentGroup,
        name: file.name,
        size: file.size,
        uploader: userData.fullname || '–°—Ç—É–¥–µ–Ω—Ç',
        createdAt: Date.now(),
        dataUrl: e.target.result
      });
    } catch(err) { alert('–ü–æ–º–∏–ª–∫–∞: ' + err.message); }
    zone.innerHTML = '<div class="up-icon">üì§</div><p><strong>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∞–±–æ –ø–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–∞–π–ª</strong></p><p style="margin-top:3px;font-size:11px;">PDF, DOCX, PPTX, XLSX —Ç–∞ —ñ–Ω—à—ñ (–¥–æ 5–ú–ë)</p>';
  };
  reader.readAsDataURL(file);
}
function renderFiles(files) {
  const el = document.getElementById('group-files-list');
  if (!files.length) { el.innerHTML = '<div class="empty-state"><div class="emoji">üìÇ</div><p>–§–∞–π–ª—ñ–≤ —â–µ –Ω–µ–º–∞—î. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø–µ—Ä—à–∏–π!</p></div>'; return; }
  el.innerHTML = '<div class="file-list">' + files.map(f => {
    const ext = (f.name||'file').split('.').pop().toLowerCase();
    const extCls = ext==='pdf'?'ext-pdf':['doc','docx'].includes(ext)?'ext-docx':['ppt','pptx'].includes(ext)?'ext-pptx':'ext-other';
    const size = f.size>1048576 ? (f.size/1048576).toFixed(1)+' –ú–ë' : Math.round(f.size/1024)+' –ö–ë';
    return '<div class="file-item">' +
      '<div class="file-ext ' + extCls + '">' + ext.toUpperCase() + '</div>' +
      '<div class="file-info"><div class="file-name">' + f.name + '</div>' +
      '<div class="file-meta">' + (f.uploader||'?') + ' ‚Ä¢ ' + new Date(f.createdAt).toLocaleDateString('uk-UA') + ' ‚Ä¢ ' + size + '</div></div>' +
      '<div class="file-actions">' +
        (f.dataUrl ? '<button class="btn-sm accent" onclick="dlFile(\'' + f.id + '\')">‚¨á</button>' : '') +
        '<button class="btn-sm danger" onclick="rmFile(\'' + f.id + '\')">üóë</button>' +
      '</div></div>';
  }).join('') + '</div>';
}
async function dlFile(id) {
  const f = cachedFiles.find(x => x.id===id);
  if (!f || !f.dataUrl) return;
  const a = document.createElement('a'); a.href=f.dataUrl; a.download=f.name; a.click();
}
async function rmFile(id) {
  if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–∞–π–ª?')) return;
  const { doc, deleteDoc } = window._fb;
  await deleteDoc(doc(window._db, 'files', id));
}

// ‚îÄ‚îÄ MATERIALS (Firebase) ‚îÄ‚îÄ
function listenMats() {
  if (!window._db || !currentGroup) return;
  const { collection, query, where, orderBy, onSnapshot } = window._fb;
  if (unsubMats) unsubMats();
  const q = query(collection(window._db, 'materials'), where('group', '==', currentGroup), orderBy('createdAt', 'desc'));
  unsubMats = onSnapshot(q, snap => {
    cachedMats = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderMats(cachedMats);
  });
}
function filterMaterials(q) { renderMats(cachedMats, q.toLowerCase()); }
function renderMats(list, q='') {
  const el = document.getElementById('materials-list');
  const items = q ? list.filter(m => (m.name||'').toLowerCase().includes(q)||(m.subject||'').toLowerCase().includes(q)) : list;
  if (!items.length) { el.innerHTML = '<div class="empty-state"><div class="emoji">üìù</div><p>–ú–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ —â–µ –Ω–µ–º–∞—î. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π!</p></div>'; return; }
  el.innerHTML = '<div class="file-list">' + items.map(m =>
    '<div class="file-item">' +
    '<div class="file-ext ext-other">üìù</div>' +
    '<div class="file-info"><div class="file-name">' + (m.name||'') + '</div>' +
    '<div class="file-meta">' + (m.subject||'') + (m.desc?' ‚Ä¢ '+m.desc:'') + ' ‚Ä¢ ' + (m.uploader||'?') + '</div></div>' +
    '<div class="file-actions">' +
      (m.desc&&m.desc.startsWith('http') ? '<a href="' + m.desc + '" target="_blank"><button class="btn-sm accent">üîó</button></a>' : '') +
      '<button class="btn-sm danger" onclick="rmMat(\'' + m.id + '\')">üóë</button>' +
    '</div></div>'
  ).join('') + '</div>';
}
function showAddMaterial() { document.getElementById('add-material-modal').classList.add('show'); }
function closeModal() { document.getElementById('add-material-modal').classList.remove('show'); }
async function addMaterial() {
  const name = document.getElementById('mat-name').value.trim();
  const subject = document.getElementById('mat-subject').value.trim();
  const desc = document.getElementById('mat-desc').value.trim();
  if (!name) return;
  if (!window._db) { alert('Firebase –Ω–µ –≥–æ—Ç–æ–≤–∏–π'); return; }
  const { collection, addDoc } = window._fb;
  await addDoc(collection(window._db, 'materials'), { group: currentGroup, name, subject, desc, uploader: userData.fullname||'–°—Ç—É–¥–µ–Ω—Ç', createdAt: Date.now() });
  closeModal();
  ['mat-name','mat-subject','mat-desc'].forEach(id => document.getElementById(id).value='');
}
async function rmMat(id) {
  if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª?')) return;
  const { doc, deleteDoc } = window._fb;
  await deleteDoc(doc(window._db, 'materials', id));
}

// ‚îÄ‚îÄ NAV ‚îÄ‚îÄ
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
  const map = { dashboard:'–ì–æ–ª–æ–≤–Ω–∞', deadlines:'–î–µ–¥–ª–∞–π–Ω–∏', courses:'–ö—É—Ä—Å–∏', files:'–§–∞–π–ª–∏', materials:'–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏' };
  document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', n.textContent.trim()===map[name]));
}

// ‚îÄ‚îÄ THEME ‚îÄ‚îÄ
function toggleTheme() {
  const t = document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark';
  document.documentElement.setAttribute('data-theme', t);
  localStorage.setItem('sh_theme', t);
}
const st = localStorage.getItem('sh_theme');
if (st) document.documentElement.setAttribute('data-theme', st);

// ‚îÄ‚îÄ LOGOUT ‚îÄ‚îÄ
function doLogout() {
  if (unsubFiles) unsubFiles();
  if (unsubMats) unsubMats();
  token=''; userData={}; allDeadlines=[]; courses=[]; currentGroup=''; cachedFiles=[]; cachedMats=[];
  localStorage.removeItem('sh_token'); localStorage.removeItem('sh_group');
  document.getElementById('app').style.display='none';
  document.getElementById('login-screen').style.display='flex';
}

// ‚îÄ‚îÄ AUTO LOGIN ‚îÄ‚îÄ
const sv = localStorage.getItem('sh_token'), sg = localStorage.getItem('sh_group');
if (sv && sg) { token=sv; currentGroup=sg; initApp(); }
</script>
</body>
</html>
