<!DOCTYPE html>
<html lang="uk" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Hub ‚Äî –£–∫—Ä–î–£–ó–¢</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --bg2: #111118;
    --bg3: #1a1a24;
    --border: #2a2a3a;
    --accent: #f0c040;
    --accent2: #e05050;
    --text: #e8e8f0;
    --text2: #8888aa;
    --card: #13131e;
    --success: #40d080;
    --warning: #f0a030;
    --radius: 12px;
  }
  [data-theme="light"] {
    --bg: #f4f4f8;
    --bg2: #ffffff;
    --bg3: #ebebf3;
    --border: #d0d0e0;
    --text: #1a1a2e;
    --text2: #6060880;
    --card: #ffffff;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Syne', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    transition: background 0.3s, color 0.3s;
  }
  code, .mono { font-family: 'JetBrains Mono', monospace; }

  /* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
  #login-screen {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg);
    position: relative;
    overflow: hidden;
  }
  #login-screen::before {
    content: '';
    position: absolute;
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(240,192,64,0.08) 0%, transparent 70%);
    top: -200px; right: -200px;
    pointer-events: none;
  }
  #login-screen::after {
    content: '';
    position: absolute;
    width: 400px; height: 400px;
    background: radial-gradient(circle, rgba(224,80,80,0.06) 0%, transparent 70%);
    bottom: -100px; left: -100px;
    pointer-events: none;
  }
  .login-box {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 48px;
    width: 420px;
    max-width: 95vw;
    position: relative;
    z-index: 1;
    animation: fadeUp 0.6s ease;
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .login-logo {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 32px;
  }
  .login-logo .icon {
    width: 44px; height: 44px;
    background: var(--accent);
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
  }
  .login-logo h1 { font-size: 22px; font-weight: 800; letter-spacing: -0.5px; }
  .login-logo span { color: var(--accent); }
  .login-box h2 { font-size: 28px; font-weight: 800; margin-bottom: 6px; }
  .login-box p { color: var(--text2); font-size: 14px; margin-bottom: 28px; }
  .field { margin-bottom: 16px; }
  .field label { display: block; font-size: 12px; font-weight: 600; color: var(--text2); margin-bottom: 6px; letter-spacing: 0.5px; text-transform: uppercase; }
  .field input {
    width: 100%;
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px 16px;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }
  .field input:focus { border-color: var(--accent); }
  .btn-primary {
    width: 100%;
    background: var(--accent);
    color: #0a0a0f;
    border: none;
    border-radius: var(--radius);
    padding: 14px;
    font-family: 'Syne', sans-serif;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
    margin-top: 8px;
  }
  .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
  .btn-primary:active { transform: translateY(0); }
  .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
  .login-error {
    background: rgba(224,80,80,0.1);
    border: 1px solid rgba(224,80,80,0.3);
    border-radius: var(--radius);
    padding: 12px 16px;
    font-size: 13px;
    color: var(--accent2);
    margin-top: 12px;
    display: none;
  }
  .login-info {
    font-size: 12px;
    color: var(--text2);
    text-align: center;
    margin-top: 16px;
  }

  /* ‚îÄ‚îÄ APP ‚îÄ‚îÄ */
  #app { display: none; min-height: 100vh; }

  /* Sidebar */
  .sidebar {
    position: fixed;
    left: 0; top: 0; bottom: 0;
    width: 240px;
    background: var(--bg2);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    z-index: 100;
    transition: background 0.3s;
  }
  .sidebar-logo {
    padding: 24px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    border-bottom: 1px solid var(--border);
  }
  .sidebar-logo .icon {
    width: 36px; height: 36px;
    background: var(--accent);
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }
  .sidebar-logo h1 { font-size: 16px; font-weight: 800; }
  .sidebar-logo span { color: var(--accent); }
  .nav { padding: 16px 12px; flex: 1; }
  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    color: var(--text2);
    transition: all 0.15s;
    margin-bottom: 2px;
  }
  .nav-item:hover { background: var(--bg3); color: var(--text); }
  .nav-item.active { background: rgba(240,192,64,0.12); color: var(--accent); }
  .nav-item .nav-icon { font-size: 16px; width: 20px; text-align: center; }
  .sidebar-bottom {
    padding: 16px 12px;
    border-top: 1px solid var(--border);
  }
  .user-card {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 8px;
    background: var(--bg3);
  }
  .user-avatar {
    width: 32px; height: 32px;
    background: var(--accent);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 14px;
    font-weight: 700;
    color: #0a0a0f;
    flex-shrink: 0;
  }
  .user-info { flex: 1; min-width: 0; }
  .user-name { font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .user-role { font-size: 11px; color: var(--text2); }
  .theme-btn {
    background: none;
    border: none;
    color: var(--text2);
    cursor: pointer;
    font-size: 16px;
    padding: 4px;
    border-radius: 6px;
    transition: color 0.2s;
  }
  .theme-btn:hover { color: var(--text); }

  /* Main */
  .main {
    margin-left: 240px;
    min-height: 100vh;
    padding: 32px;
  }
  .page { display: none; animation: fadeIn 0.3s ease; }
  .page.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

  .page-header { margin-bottom: 28px; }
  .page-header h2 { font-size: 28px; font-weight: 800; margin-bottom: 4px; }
  .page-header p { color: var(--text2); font-size: 14px; }

  /* Cards grid */
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
  }
  .stat-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
  }
  .stat-icon {
    width: 48px; height: 48px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
    flex-shrink: 0;
  }
  .stat-icon.yellow { background: rgba(240,192,64,0.15); }
  .stat-icon.red { background: rgba(224,80,80,0.15); }
  .stat-icon.green { background: rgba(64,208,128,0.15); }
  .stat-icon.blue { background: rgba(64,128,240,0.15); }
  .stat-val { font-size: 28px; font-weight: 800; font-family: 'JetBrains Mono', monospace; }
  .stat-label { font-size: 13px; color: var(--text2); }

  /* Deadlines */
  .deadline-list { display: flex; flex-direction: column; gap: 10px; margin-top: 8px; }
  .deadline-item {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    transition: border-color 0.2s;
  }
  .deadline-item:hover { border-color: var(--accent); }
  .deadline-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    flex-shrink: 0;
  }
  .deadline-dot.urgent { background: var(--accent2); box-shadow: 0 0 8px rgba(224,80,80,0.5); }
  .deadline-dot.soon { background: var(--warning); }
  .deadline-dot.ok { background: var(--success); }
  .deadline-info { flex: 1; }
  .deadline-name { font-size: 14px; font-weight: 600; margin-bottom: 2px; }
  .deadline-course { font-size: 12px; color: var(--text2); }
  .deadline-date {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: var(--text2);
    text-align: right;
  }
  .deadline-date.urgent { color: var(--accent2); }
  .deadline-date.soon { color: var(--warning); }

  /* Files / Materials */
  .section-title {
    font-size: 13px;
    font-weight: 700;
    color: var(--text2);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin: 24px 0 12px;
  }
  .file-list { display: flex; flex-direction: column; gap: 8px; }
  .file-item {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px 18px;
    display: flex;
    align-items: center;
    gap: 14px;
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
  }
  .file-item:hover { border-color: var(--accent); background: var(--bg3); }
  .file-ext {
    width: 38px; height: 38px;
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 10px;
    font-weight: 700;
    font-family: 'JetBrains Mono', monospace;
    flex-shrink: 0;
  }
  .file-ext.pdf { background: rgba(224,80,80,0.15); color: var(--accent2); }
  .file-ext.docx { background: rgba(64,128,240,0.15); color: #4080f0; }
  .file-ext.pptx { background: rgba(240,128,64,0.15); color: #f08040; }
  .file-ext.other { background: var(--bg3); color: var(--text2); }
  .file-info { flex: 1; }
  .file-name { font-size: 14px; font-weight: 600; }
  .file-meta { font-size: 12px; color: var(--text2); margin-top: 2px; }
  .file-actions { display: flex; gap: 8px; }
  .btn-sm {
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 12px;
    font-weight: 600;
    color: var(--text2);
    cursor: pointer;
    transition: all 0.15s;
    font-family: 'Syne', sans-serif;
  }
  .btn-sm:hover { border-color: var(--accent); color: var(--accent); }
  .btn-sm.accent { background: var(--accent); border-color: var(--accent); color: #0a0a0f; }
  .btn-sm.accent:hover { opacity: 0.85; color: #0a0a0f; }

  /* Upload zone */
  .upload-zone {
    border: 2px dashed var(--border);
    border-radius: var(--radius);
    padding: 32px;
    text-align: center;
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
    margin-bottom: 20px;
  }
  .upload-zone:hover, .upload-zone.drag { border-color: var(--accent); background: rgba(240,192,64,0.04); }
  .upload-zone .up-icon { font-size: 32px; margin-bottom: 8px; }
  .upload-zone p { font-size: 14px; color: var(--text2); }
  .upload-zone strong { color: var(--accent); }
  #file-input { display: none; }

  /* Courses */
  .course-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px; }
  .course-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    cursor: pointer;
    transition: border-color 0.2s, transform 0.15s;
  }
  .course-card:hover { border-color: var(--accent); transform: translateY(-2px); }
  .course-num {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--accent);
    font-weight: 500;
    margin-bottom: 8px;
  }
  .course-name { font-size: 15px; font-weight: 700; margin-bottom: 6px; line-height: 1.3; }
  .course-meta { font-size: 12px; color: var(--text2); }

  /* Loading */
  .loading {
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--text2);
    font-size: 14px;
    padding: 20px 0;
  }
  .spinner {
    width: 18px; height: 18px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .empty-state {
    text-align: center;
    padding: 48px 20px;
    color: var(--text2);
  }
  .empty-state .emoji { font-size: 40px; margin-bottom: 12px; }
  .empty-state p { font-size: 14px; }

  /* Tags */
  .tag {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    background: var(--bg3);
    color: var(--text2);
    border: 1px solid var(--border);
  }
  .tag.yellow { background: rgba(240,192,64,0.12); color: var(--accent); border-color: rgba(240,192,64,0.2); }
  .tag.green { background: rgba(64,208,128,0.12); color: var(--success); border-color: rgba(64,208,128,0.2); }
  .tag.red { background: rgba(224,80,80,0.12); color: var(--accent2); border-color: rgba(224,80,80,0.2); }

  /* Toolbar */
  .toolbar {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  .toolbar input[type="text"] {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px 14px;
    color: var(--text);
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    outline: none;
    width: 240px;
    transition: border-color 0.2s;
  }
  .toolbar input[type="text"]:focus { border-color: var(--accent); }
  .toolbar-right { margin-left: auto; display: flex; gap: 8px; }

  /* Logout */
  .logout-btn {
    background: none;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 6px 10px;
    color: var(--text2);
    cursor: pointer;
    font-size: 14px;
    transition: all 0.15s;
  }
  .logout-btn:hover { border-color: var(--accent2); color: var(--accent2); }

  /* Responsive */
  @media (max-width: 768px) {
    .sidebar { transform: translateX(-100%); }
    .main { margin-left: 0; padding: 20px; }
  }

  /* Sync badge */
  .sync-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(64,208,128,0.1);
    border: 1px solid rgba(64,208,128,0.2);
    border-radius: 20px;
    padding: 4px 12px;
    font-size: 11px;
    color: var(--success);
    font-weight: 600;
  }
  .sync-dot { width: 6px; height: 6px; background: var(--success); border-radius: 50%; animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

  /* Modal */
  .modal-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.7);
    display: flex; align-items: center; justify-content: center;
    z-index: 999;
    display: none;
  }
  .modal-overlay.show { display: flex; }
  .modal {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 32px;
    width: 480px;
    max-width: 95vw;
    animation: fadeUp 0.3s ease;
  }
  .modal h3 { font-size: 20px; font-weight: 800; margin-bottom: 20px; }
  .modal .field { margin-bottom: 14px; }
  .modal select {
    width: 100%;
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px 16px;
    color: var(--text);
    font-family: 'Syne', sans-serif;
    font-size: 14px;
    outline: none;
  }
  .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">
      <div class="icon">üéì</div>
      <h1>Student<span>Hub</span></h1>
    </div>
    <h2>–í—Ö—ñ–¥</h2>
    <p>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ª–æ–≥—ñ–Ω —Ç–∞ –ø–∞—Ä–æ–ª—å –≤—ñ–¥ Moodle –£–∫—Ä–î–£–ó–¢</p>
    <div class="field">
      <label>–õ–æ–≥—ñ–Ω (email –∞–±–æ username)</label>
      <input type="text" id="login-input" placeholder="kunec2024@kart.edu.ua" autocomplete="username">
    </div>
    <div class="field">
      <label>–ü–∞—Ä–æ–ª—å</label>
      <input type="password" id="pass-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
    </div>
    <button class="btn-primary" id="login-btn" onclick="doLogin()">–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Moodle</button>
    <div class="login-error" id="login-error"></div>
    <p class="login-info">–í–∞—à—ñ –¥–∞–Ω—ñ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä –£–∫—Ä–î–£–ó–¢ —ñ –Ω—ñ–¥–µ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è</p>
  </div>
</div>

<!-- APP -->
<div id="app">
  <nav class="sidebar">
    <div class="sidebar-logo">
      <div class="icon">üéì</div>
      <h1>Student<span>Hub</span></h1>
    </div>
    <div class="nav">
      <div class="nav-item active" onclick="showPage('dashboard')">
        <span class="nav-icon">üè†</span> –ì–æ–ª–æ–≤–Ω–∞
      </div>
      <div class="nav-item" onclick="showPage('deadlines')">
        <span class="nav-icon">‚è∞</span> –î–µ–¥–ª–∞–π–Ω–∏
      </div>
      <div class="nav-item" onclick="showPage('courses')">
        <span class="nav-icon">üìö</span> –ö—É—Ä—Å–∏
      </div>
      <div class="nav-item" onclick="showPage('files')">
        <span class="nav-icon">üìÅ</span> –§–∞–π–ª–∏ –≥—Ä—É–ø–∏
      </div>
      <div class="nav-item" onclick="showPage('materials')">
        <span class="nav-icon">üìù</span> –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏
      </div>
    </div>
    <div class="sidebar-bottom">
      <div class="user-card">
        <div class="user-avatar" id="user-avatar">?</div>
        <div class="user-info">
          <div class="user-name" id="user-name">...</div>
          <div class="user-role">–°—Ç—É–¥–µ–Ω—Ç</div>
        </div>
        <button class="theme-btn" onclick="toggleTheme()" title="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É">üåì</button>
        <button class="logout-btn" onclick="doLogout()" title="–í–∏–π—Ç–∏">‚Ü©</button>
      </div>
    </div>
  </nav>

  <main class="main">
    <!-- DASHBOARD -->
    <div class="page active" id="page-dashboard">
      <div class="page-header">
        <h2>–î–æ–±—Ä–∏–π –¥–µ–Ω—å! üëã</h2>
        <p id="dash-subtitle">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ Moodle...</p>
      </div>
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:24px;">
        <div class="sync-badge"><div class="sync-dot"></div> –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ –∑ Moodle</div>
        <button class="btn-sm" onclick="syncMoodle()">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
      </div>
      <div class="cards-grid" id="stat-cards">
        <div class="stat-card">
          <div class="stat-icon yellow">üìö</div>
          <div><div class="stat-val" id="stat-courses">‚Äî</div><div class="stat-label">–ê–∫—Ç–∏–≤–Ω–∏—Ö –∫—É—Ä—Å—ñ–≤</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon red">‚è∞</div>
          <div><div class="stat-val" id="stat-urgent">‚Äî</div><div class="stat-label">–¢–µ—Ä–º—ñ–Ω–æ–≤–æ –∑–¥–∞—Ç–∏</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon green">‚úÖ</div>
          <div><div class="stat-val" id="stat-done">‚Äî</div><div class="stat-label">–ó–¥–∞–Ω–æ –∑–∞–≤–¥–∞–Ω—å</div></div>
        </div>
        <div class="stat-card">
          <div class="stat-icon blue">üìÅ</div>
          <div><div class="stat-val" id="stat-files">‚Äî</div><div class="stat-label">–§–∞–π–ª—ñ–≤ —É –≥—Ä—É–ø—ñ</div></div>
        </div>
      </div>
      <div class="section-title">–ù–∞–π–±–ª–∏–∂—á—ñ –¥–µ–¥–ª–∞–π–Ω–∏</div>
      <div id="dash-deadlines"><div class="loading"><div class="spinner"></div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div></div>
    </div>

    <!-- DEADLINES -->
    <div class="page" id="page-deadlines">
      <div class="page-header">
        <h2>‚è∞ –î–µ–¥–ª–∞–π–Ω–∏</h2>
        <p>–ó–∞–≤–¥–∞–Ω–Ω—è –∑ Moodle ‚Äî –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</p>
      </div>
      <div class="toolbar">
        <input type="text" placeholder="üîç –ü–æ—à—É–∫ –∑–∞–≤–¥–∞–Ω–Ω—è..." oninput="filterDeadlines(this.value)">
        <div class="toolbar-right">
          <button class="btn-sm accent" onclick="syncMoodle()">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏</button>
        </div>
      </div>
      <div id="deadlines-list"><div class="loading"><div class="spinner"></div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ Moodle...</div></div>
    </div>

    <!-- COURSES -->
    <div class="page" id="page-courses">
      <div class="page-header">
        <h2>üìö –ú–æ—ó –∫—É—Ä—Å–∏</h2>
        <p>–°–ø–∏—Å–æ–∫ –∫—É—Ä—Å—ñ–≤ –∑ Moodle</p>
      </div>
      <div id="courses-list"><div class="loading"><div class="spinner"></div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div></div>
    </div>

    <!-- FILES -->
    <div class="page" id="page-files">
      <div class="page-header">
        <h2>üìÅ –§–∞–π–ª–∏ –≥—Ä—É–ø–∏</h2>
        <p>–î—ñ–ª—ñ—Ç—å—Å—è —Ñ–∞–π–ª–∞–º–∏ –∑ –æ–¥–Ω–æ–≥—Ä—É–ø–Ω–∏–∫–∞–º–∏</p>
      </div>
      <div class="upload-zone" id="upload-zone" onclick="document.getElementById('file-input').click()"
           ondragover="event.preventDefault();this.classList.add('drag')"
           ondragleave="this.classList.remove('drag')"
           ondrop="handleDrop(event)">
        <div class="up-icon">üì§</div>
        <p><strong>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∞–±–æ –ø–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–∞–π–ª</strong></p>
        <p style="margin-top:4px;font-size:12px;">PDF, DOCX, PPTX, XLSX, ZIP —Ç–∞ —ñ–Ω—à—ñ</p>
      </div>
      <input type="file" id="file-input" multiple onchange="handleFileSelect(this)">
      <div class="section-title">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ —Ñ–∞–π–ª–∏</div>
      <div id="group-files-list"></div>
    </div>

    <!-- MATERIALS -->
    <div class="page" id="page-materials">
      <div class="page-header">
        <h2>üìù –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏</h2>
        <p>–ö–æ–Ω—Å–ø–µ–∫—Ç–∏, –ª–µ–∫—Ü—ñ—ó, —à–ø–∞—Ä–≥–∞–ª–∫–∏</p>
      </div>
      <div class="toolbar">
        <input type="text" placeholder="üîç –ü–æ—à—É–∫ –º–∞—Ç–µ—Ä—ñ–∞–ª—É..." oninput="filterMaterials(this.value)">
        <div class="toolbar-right">
          <button class="btn-sm accent" onclick="showAddMaterial()">+ –î–æ–¥–∞—Ç–∏</button>
        </div>
      </div>
      <div id="materials-list"></div>
    </div>
  </main>
</div>

<!-- Modal: Add Material -->
<div class="modal-overlay" id="add-material-modal">
  <div class="modal">
    <h3>üìù –î–æ–¥–∞—Ç–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª</h3>
    <div class="field">
      <label>–ù–∞–∑–≤–∞</label>
      <input type="text" id="mat-name" placeholder="–ö–æ–Ω—Å–ø–µ–∫—Ç –ø–æ –≤–∏—â—ñ–π –º–∞—Ç–µ–º–∞—Ç–∏—Ü—ñ" style="width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);padding:12px 16px;color:var(--text);font-family:'Syne',sans-serif;font-size:14px;outline:none;">
    </div>
    <div class="field">
      <label>–ü—Ä–µ–¥–º–µ—Ç / –∫—É—Ä—Å</label>
      <input type="text" id="mat-subject" placeholder="–í–∏—â–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞" style="width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);padding:12px 16px;color:var(--text);font-family:'Syne',sans-serif;font-size:14px;outline:none;">
    </div>
    <div class="field">
      <label>–û–ø–∏—Å –∞–±–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</label>
      <input type="text" id="mat-desc" placeholder="https://drive.google.com/... –∞–±–æ –∫–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å" style="width:100%;background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);padding:12px 16px;color:var(--text);font-family:'Syne',sans-serif;font-size:14px;outline:none;">
    </div>
    <div class="modal-actions">
      <button class="btn-sm" onclick="closeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      <button class="btn-sm accent" onclick="addMaterial()">–î–æ–¥–∞—Ç–∏</button>
    </div>
  </div>
</div>

<script>
const MOODLE = 'https://do.kart.edu.ua';
let token = '';
let userData = {};
let allDeadlines = [];
let allMaterials = JSON.parse(localStorage.getItem('sh_materials') || '[]');
let groupFiles = JSON.parse(localStorage.getItem('sh_files') || '[]');

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
async function doLogin() {
  const username = document.getElementById('login-input').value.trim();
  const password = document.getElementById('pass-input').value;
  const btn = document.getElementById('login-btn');
  const err = document.getElementById('login-error');
  err.style.display = 'none';
  if (!username || !password) { showErr('–í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω —Ç–∞ –ø–∞—Ä–æ–ª—å'); return; }
  btn.disabled = true; btn.textContent = '–í—Ö–æ–¥–∏–º–æ...';
  try {
    const r = await fetch(`${MOODLE}/login/token.php?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}&service=moodle_mobile_app`);
    const d = await r.json();
    if (d.token) {
      token = d.token;
      localStorage.setItem('sh_token', token);
      await initApp();
    } else {
      showErr(d.error || '–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å');
    }
  } catch(e) {
    showErr('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Moodle. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç.');
  }
  btn.disabled = false; btn.textContent = '–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Moodle';
}

function showErr(msg) {
  const err = document.getElementById('login-error');
  err.textContent = msg; err.style.display = 'block';
}

document.getElementById('pass-input').addEventListener('keydown', e => { if(e.key==='Enter') doLogin(); });
document.getElementById('login-input').addEventListener('keydown', e => { if(e.key==='Enter') doLogin(); });

async function initApp() {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app').style.display = 'block';
  await loadUserInfo();
  await syncMoodle();
  renderGroupFiles();
  renderMaterials();
}

async function loadUserInfo() {
  try {
    const d = await moodleCall('core_webservice_get_site_info');
    userData = d;
    const name = d.fullname || '–°—Ç—É–¥–µ–Ω—Ç';
    document.getElementById('user-name').textContent = name;
    document.getElementById('user-avatar').textContent = name[0].toUpperCase();
    const today = new Date().toLocaleDateString('uk-UA', {weekday:'long', day:'numeric', month:'long'});
    document.getElementById('dash-subtitle').textContent = today + ' ‚Ä¢ ' + name;
  } catch(e) {}
}

async function syncMoodle() {
  await Promise.all([loadCourses(), loadDeadlines()]);
}

// ‚îÄ‚îÄ MOODLE API ‚îÄ‚îÄ
async function moodleCall(fn, params = {}) {
  const p = new URLSearchParams({ wstoken: token, wsfunction: fn, moodlewsrestformat: 'json', ...params });
  const r = await fetch(`${MOODLE}/webservice/rest/server.php?${p}`);
  return r.json();
}

let courses = [];
async function loadCourses() {
  try {
    const info = await moodleCall('core_webservice_get_site_info');
    const userId = info.userid;
    const d = await moodleCall('core_enrol_get_users_courses', { userid: userId });
    courses = Array.isArray(d) ? d : [];
    document.getElementById('stat-courses').textContent = courses.length;
    renderCourses();
  } catch(e) { courses = []; }
}

function renderCourses() {
  const el = document.getElementById('courses-list');
  if (!courses.length) { el.innerHTML = '<div class="empty-state"><div class="emoji">üìö</div><p>–ö—É—Ä—Å–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p></div>'; return; }
  el.innerHTML = '<div class="course-list">' + courses.map((c,i) =>
    `<div class="course-card">
      <div class="course-num">–ö—É—Ä—Å #${i+1}</div>
      <div class="course-name">${c.fullname || c.shortname}</div>
      <div class="course-meta">${c.shortname || ''}</div>
    </div>`
  ).join('') + '</div>';
}

async function loadDeadlines() {
  try {
    const now = Math.floor(Date.now()/1000);
    const future = now + 60*60*24*60;
    const d = await moodleCall('core_calendar_get_action_events_by_timesort', {
      timesortfrom: now, timesortto: future, limitnum: 50
    });
    const events = d.events || [];
    allDeadlines = events.map(e => ({
      id: e.id,
      name: e.name,
      course: e.course ? e.course.fullname : '–ù–µ–≤—ñ–¥–æ–º–∏–π –∫—É—Ä—Å',
      due: e.timesort || e.timeusermidnight,
      submitted: e.action ? e.action.actionable === false : false,
      url: e.url || '#'
    }));
    updateDeadlineStats();
    renderDeadlines(allDeadlines);
    renderDashDeadlines();
  } catch(e) {
    document.getElementById('deadlines-list').innerHTML = '<div class="empty-state"><div class="emoji">‚ö†Ô∏è</div><p>–ù–µ –≤–¥–∞–ª–æ—Å—å –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–µ–¥–ª–∞–π–Ω–∏</p></div>';
  }
}

function getDotClass(ts) {
  const diff = ts - Date.now()/1000;
  if (diff < 60*60*48) return 'urgent';
  if (diff < 60*60*24*7) return 'soon';
  return 'ok';
}

function formatDate(ts) {
  return new Date(ts*1000).toLocaleDateString('uk-UA', {day:'numeric', month:'short', hour:'2-digit', minute:'2-digit'});
}

function updateDeadlineStats() {
  const now = Date.now()/1000;
  const urgent = allDeadlines.filter(d => !d.submitted && (d.due - now) < 60*60*48).length;
  const done = allDeadlines.filter(d => d.submitted).length;
  document.getElementById('stat-urgent').textContent = urgent;
  document.getElementById('stat-done').textContent = done;
}

function renderDeadlines(list) {
  const el = document.getElementById('deadlines-list');
  if (!list.length) { el.innerHTML = '<div class="empty-state"><div class="emoji">üéâ</div><p>–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö –¥–µ–¥–ª–∞–π–Ω—ñ–≤!</p></div>'; return; }
  el.innerHTML = '<div class="deadline-list">' + list.map(d => {
    const cls = getDotClass(d.due);
    return `<div class="deadline-item">
      <div class="deadline-dot ${cls}"></div>
      <div class="deadline-info">
        <div class="deadline-name">${d.name}</div>
        <div class="deadline-course">${d.course}</div>
      </div>
      <div class="deadline-date ${cls}">${formatDate(d.due)}</div>
      ${d.submitted ? '<span class="tag green">–ó–¥–∞–Ω–æ</span>' : ''}
    </div>`;
  }).join('') + '</div>';
}

function renderDashDeadlines() {
  const el = document.getElementById('dash-deadlines');
  const top = allDeadlines.filter(d => !d.submitted).slice(0,5);
  if (!top.length) { el.innerHTML = '<div class="empty-state"><div class="emoji">üéâ</div><p>–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö –¥–µ–¥–ª–∞–π–Ω—ñ–≤!</p></div>'; return; }
  el.innerHTML = '<div class="deadline-list">' + top.map(d => {
    const cls = getDotClass(d.due);
    return `<div class="deadline-item">
      <div class="deadline-dot ${cls}"></div>
      <div class="deadline-info">
        <div class="deadline-name">${d.name}</div>
        <div class="deadline-course">${d.course}</div>
      </div>
      <div class="deadline-date ${cls}">${formatDate(d.due)}</div>
    </div>`;
  }).join('') + '</div>';
}

function filterDeadlines(q) {
  const filtered = allDeadlines.filter(d => d.name.toLowerCase().includes(q.toLowerCase()) || d.course.toLowerCase().includes(q.toLowerCase()));
  renderDeadlines(filtered);
}

// ‚îÄ‚îÄ FILES ‚îÄ‚îÄ
function handleFileSelect(input) {
  Array.from(input.files).forEach(addFile);
}
function handleDrop(e) {
  e.preventDefault();
  document.getElementById('upload-zone').classList.remove('drag');
  Array.from(e.dataTransfer.files).forEach(addFile);
}
function addFile(file) {
  const entry = {
    id: Date.now() + Math.random(),
    name: file.name,
    size: file.size,
    type: file.type,
    uploader: userData.fullname || '–í–∏',
    date: new Date().toLocaleDateString('uk-UA'),
    dataUrl: null
  };
  const reader = new FileReader();
  reader.onload = e => {
    entry.dataUrl = e.target.result;
    groupFiles.unshift(entry);
    saveFiles();
    renderGroupFiles();
  };
  reader.readAsDataURL(file);
}
function saveFiles() {
  // Store only metadata (not dataUrl for large files) to avoid quota issues
  const meta = groupFiles.map(f => ({...f, dataUrl: f.dataUrl && f.dataUrl.length < 500000 ? f.dataUrl : null}));
  try { localStorage.setItem('sh_files', JSON.stringify(meta)); } catch(e) {}
  document.getElementById('stat-files').textContent = groupFiles.length;
}
function renderGroupFiles() {
  const el = document.getElementById('group-files-list');
  document.getElementById('stat-files').textContent = groupFiles.length;
  if (!groupFiles.length) { el.innerHTML = '<div class="empty-state"><div class="emoji">üìÇ</div><p>–§–∞–π–ª—ñ–≤ —â–µ –Ω–µ–º–∞—î. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø–µ—Ä—à–∏–π!</p></div>'; return; }
  el.innerHTML = '<div class="file-list">' + groupFiles.map((f,i) => {
    const ext = f.name.split('.').pop().toLowerCase();
    const extClass = ['pdf'].includes(ext) ? 'pdf' : ['doc','docx'].includes(ext) ? 'docx' : ['ppt','pptx'].includes(ext) ? 'pptx' : 'other';
    const size = f.size > 1048576 ? (f.size/1048576).toFixed(1)+' –ú–ë' : (f.size/1024).toFixed(0)+' –ö–ë';
    return `<div class="file-item">
      <div class="file-ext ${extClass}">${ext.toUpperCase()}</div>
      <div class="file-info">
        <div class="file-name">${f.name}</div>
        <div class="file-meta">${f.uploader} ‚Ä¢ ${f.date} ‚Ä¢ ${size}</div>
      </div>
      <div class="file-actions">
        ${f.dataUrl ? `<button class="btn-sm accent" onclick="downloadFile(${i})">‚¨á –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>` : ''}
        <button class="btn-sm" onclick="deleteFile(${i})" style="color:var(--accent2)">üóë</button>
      </div>
    </div>`;
  }).join('') + '</div>';
}
function downloadFile(i) {
  const f = groupFiles[i];
  if (!f.dataUrl) return;
  const a = document.createElement('a');
  a.href = f.dataUrl; a.download = f.name; a.click();
}
function deleteFile(i) {
  groupFiles.splice(i, 1);
  saveFiles(); renderGroupFiles();
}

// ‚îÄ‚îÄ MATERIALS ‚îÄ‚îÄ
function renderMaterials(filter = '') {
  const el = document.getElementById('materials-list');
  const list = filter ? allMaterials.filter(m => m.name.toLowerCase().includes(filter) || m.subject.toLowerCase().includes(filter)) : allMaterials;
  if (!list.length) { el.innerHTML = '<div class="empty-state"><div class="emoji">üìù</div><p>–ú–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ —â–µ –Ω–µ–º–∞—î. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π!</p></div>'; return; }
  el.innerHTML = '<div class="file-list">' + list.map((m,i) =>
    `<div class="file-item">
      <div class="file-ext other">üìù</div>
      <div class="file-info">
        <div class="file-name">${m.name}</div>
        <div class="file-meta">${m.subject} ‚Ä¢ ${m.desc || ''}</div>
      </div>
      <div class="file-actions">
        ${m.desc && m.desc.startsWith('http') ? `<a href="${m.desc}" target="_blank"><button class="btn-sm accent">üîó –í—ñ–¥–∫—Ä–∏—Ç–∏</button></a>` : ''}
        <button class="btn-sm" onclick="deleteMaterial(${i})" style="color:var(--accent2)">üóë</button>
      </div>
    </div>`
  ).join('') + '</div>';
}
function filterMaterials(q) { renderMaterials(q.toLowerCase()); }
function showAddMaterial() { document.getElementById('add-material-modal').classList.add('show'); }
function closeModal() { document.getElementById('add-material-modal').classList.remove('show'); }
function addMaterial() {
  const name = document.getElementById('mat-name').value.trim();
  const subject = document.getElementById('mat-subject').value.trim();
  const desc = document.getElementById('mat-desc').value.trim();
  if (!name) return;
  allMaterials.unshift({ name, subject, desc, date: new Date().toLocaleDateString('uk-UA') });
  localStorage.setItem('sh_materials', JSON.stringify(allMaterials));
  closeModal();
  renderMaterials();
  document.getElementById('mat-name').value = '';
  document.getElementById('mat-subject').value = '';
  document.getElementById('mat-desc').value = '';
}
function deleteMaterial(i) { allMaterials.splice(i,1); localStorage.setItem('sh_materials', JSON.stringify(allMaterials)); renderMaterials(); }

// ‚îÄ‚îÄ NAV ‚îÄ‚îÄ
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => { if(n.textContent.trim().toLowerCase().includes(name === 'dashboard' ? '–≥–æ–ª–æ–≤' : name === 'deadlines' ? '–¥–µ–¥–ª' : name === 'courses' ? '–∫—É—Ä—Å' : name === 'files' ? '—Ñ–∞–π–ª' : '–º–∞—Ç–µ—Ä')) n.classList.add('active'); });
}

// ‚îÄ‚îÄ THEME ‚îÄ‚îÄ
function toggleTheme() {
  const t = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', t);
  localStorage.setItem('sh_theme', t);
}
const savedTheme = localStorage.getItem('sh_theme');
if (savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);

// ‚îÄ‚îÄ LOGOUT ‚îÄ‚îÄ
function doLogout() {
  token = ''; userData = {}; allDeadlines = []; courses = [];
  localStorage.removeItem('sh_token');
  document.getElementById('app').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
}

// ‚îÄ‚îÄ AUTO LOGIN ‚îÄ‚îÄ
const savedToken = localStorage.getItem('sh_token');
if (savedToken) { token = savedToken; initApp(); }
</script>
</body>
</html>
